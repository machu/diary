---
title: tDiary を 2.1.4 へアップデート
date: 2006-04-30T00:00:00.000Z
lastmod: 2006-04-30T14:48:42.000Z
draft: false
tags:
  - tDiary
---

時間ができたからやるシリーズ第二弾として、この日記の tDiary を [2.1.4](http://www.tdiary.org/20060415.html) へアップデートした。

2.1.4 から[リンク元の仕様が変わり](http://www.tdiary.org/ml/devel.rb?key=/mailarchive/forum.php%3Fthread_id%3D9605476%26forum_id%3D8349)、従来の「本日のリンク元」から「以前の日記へのリンク元」が分離された。

* 「本日のリンク元」には、今見ているページへのリファラのみが表示される。
* 「以前の日記へのリンク元」には、日記全体へのリファラが表示される。
* 「以前の日記へのリンク元」は、最新の日記にしか表示されない。
* 「以前の日記へのリンク元」は、新しい日記を書くとクリアされる。

これまでは、「本日のリンク元」にこれら両方が記録されていたので、本当にその日の日記へのリファラかどうかが分からなかった。 これが解消されるので、かなりいい感じ。 しばらくリンク元を隠す設定で使っていたけど、これを機に表示するようにしよう。

以下、アップデートの作業手順の覚書。

1. 【重要】現在の日記のデータフォルダをバックアップ。
2. [ダウンロードページ](http://www.tdiary.org/20021112.html)から最新の開発版（フルセット）を取得して展開 (仮に diary-new というディレクトリに展開したとする) 。
3. 現在の日記の .htaccess を新しい日記へコピー。 (cp diary/.htaccess diary-new/
4. diff -u diary/tdiary.conf diary-new/tdiary.conf.sample で設定ファイルの差分を取得。新しい設定ファイルへ反映させる。（設定ファイルの内容が少し変わっているので、そのまま上書きはまずい）
5. jdate プラグインを現在の日記の misc/plugin から新しい日記へコピー。
6. cp misc/plugin/trackback/tb.rb ./tb.cgi
7. index.rb と update.rb と tb.rb の拡張子を .cgi にリネーム。さらにこれらファイルの一行目のパスを /home/machu/bin/ruby に変更。（自分でコンパイルした Ruby で動かすため）
8. section\_footer.rb を新しい日記へコピー。
9. 自作のプラグインとテーマファイルを新しい日記へコピー。
10. images/ ディレクトリを新しい日記へコピー。（絵日記プラグインの画像ファイル置き場）
11. 新しい日記のディレクトリを現在の日記へリネーム。

古い日記と新しい日記を一時的に両方動かしていたら、移行時に古いリファラの一部が消えちゃった。 まぁ、気にしないことにしよう。
