---
title: はてなブックマークカウンタープラグイン
date: 2006-10-10T00:00:00.000Z
lastmod: 2006-11-20T13:29:13.000Z
draft: false
tags:
  - tDiary
  - plugin
  - hatena
---

![はてブカウンタープラグイン](@/assets/flickr/265870514.jpg "はてブカウンタープラグイン")

Rails の勉強は一回お休み。 [おさかなラボ](http://kaede.to/~canada/doc/hatena-count-link)さんのところに、被はてなブックマーク数を簡単に取得できる方法が書かれていた。 [人気の日記プラグイン](/posts/20051227/p02)を作った時は XMLRPC を使って面倒なことをやっていたのに、いつの間にかこんなに便利になっていたんだな…。

早速、 tDiary のプラグインにしてみる。 取り込んだのは以下の機能。

- [ブックマーク数を画像で取得する API の公開について (2006-07-12)](http://hatena.g.hatena.ne.jp/hatenabookmark/20060712/1152696382), [自分のブログに被ブックマーク数を表示する](http://b.hatena.ne.jp/help/count)
- [はてなブックマークコメントをその場で表示するライブラリの公開 (2006-09-21)](http://hatena.g.hatena.ne.jp/hatenabookmark/20060921/1158827998), [はてなブックマークコメントその場で表示ライブラリ](http://d.hatena.ne.jp/keyword/%a4%cf%a4%c6%a4%ca%a5%d6%a5%c3%a5%af%a5%de%a1%bc%a5%af%a5%b3%a5%e1%a5%f3%a5%c8%a4%bd%a4%ce%be%ec%a4%c7%c9%bd%bc%a8%a5%e9%a5%a4%a5%d6%a5%e9%a5%ea)
- [はてなブックマークカウンターの提供開始について (2006-10-04)](http://hatena.g.hatena.ne.jp/hatenabookmark/20061004/1159941842)

以下、使い方など。興味のある方は使ってみてください。

#### ダウンロード

注: tDiary 2.1.4 以降でないと動作しません。

ソースはとりあえず [trac](http://www.machu.jp/trac/tdiary_plugin/browser/trunk/plugin) で管理しています。 [hatena_bookmark_counter.rb](http://www.machu.jp/trac/tdiary_plugin/browser/trunk/plugin/hatena_bookmark_counter.rb)を開き、ページ下部の[Original Format](http://www.machu.jp/trac/tdiary_plugin/browser/trunk/plugin/hatena_bookmark_counter.rb?format=raw)からダウンロードしてください。

#### 使い方

##### 被ブックマーク数

プラグインをインストールすると、セクションの終わりに被ブックマーク情報が自動的に表示されます。

[category_to_tag.rb](http://tdiary-users.sourceforge.jp/cgi-bin/wiki.cgi?category_to_tag.rb) プラグインをインストールしている場合は、タグの横に被ブックマーク情報を並べて表示します。

##### カウンター

[はてなブックマークカウンター](http://hatena.g.hatena.ne.jp/hatenabookmark/20061004/1159941842)を表示する場合は、設定画面の「ヘッダ・フッタ」を開き、表示したい箇所に以下の内容を追記します。

```
<%= hatena_bookmark_counter %>
```

##### コメントをその場で表示

[コメントをその場で表示するライブラリ](http://hatena.g.hatena.ne.jp/hatenabookmark/20060921/1158827998)を使う場合には、もう少し設定が必要です。

1. [ライブラリ用のスタイルシート](http://www.machu.jp/trac/tdiary_plugin/browser/trunk/plugin/hatena_bookmark_counter.css)をダウンロード（先ほどと同じように、ページ下部の[Original Format](http://www.machu.jp/trac/tdiary_plugin/browser/trunk/plugin/hatena_bookmark_counter.css?format=raw)をクリック）し、 tDiary の theme ディレクトリにコピーします。
2. hatena_bookmark_counter.rb をエディタで開き、11行目を以下のように書き換えます。

```
@conf['hatena_bookmark_counter.comment_viewer'] = true
```

これで、被はてなブックマーク数の隣に、コメントをその場で表示するアイコンが表示されるようになります。 アイコンをクリックすると、はてなブックマークのコメントが表示されます。

#### その他

- 「コメントをその場で表示」機能はまだ不安定のようで、よく取得に失敗します。
- [section_footer.rb](http://hsbt.que.ne.jp/hiki/hiki.cgi?section_footer.rb) や [人気の日記プラグイン](/posts/20051227/p03)とは機能が競合するかもしれません。

#### 追記

[livedoor clip](http://clip.livedoor.com/) でも同じようにクリップ数が取得できるようなので、一緒に表示するように[修正しました](http://www.machu.jp/trac/tdiary_plugin/changeset/23)。 ダウンロード方法などは変わりません。
