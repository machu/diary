---
title: 日記へのTwitterでの「つぶやかれ数」を表示するようにした
date: 2010-04-24T00:00:00.000Z
lastmod: 2010-04-25T14:27:18.000Z
draft: false
tags:
  - tDiary
---

日記やブログを書いたときに、読者とのコミュニケーション方法は時代とともに変わってきた。 ツッコミやリファラからはじまり、（そういえば最近はあまり使われなくなった）Trackbackを経て、Deliciousやはてなブックマークなどのソーシャルブックマークで外部のサイトと繋がるようになった。 こうやってコミュニケーションのパスが増えるのはいいことだと思う。 この日記でも、エントリの最後にはてなブックマーク数を載せるようにしている。

そして最近では、はてブに加えて Twitter での反応も増えてきた。 はてブでの反応は、フィード（RSS/Atom）や検索エンジン経由で見に来てくれた人がそのままブクマするパターンが多い。 人を介してブクマが広がるのは、ホッテントリ (hotentry) に入った時くらい。 一方でTwitterでの反応は、人（によるRT）を介して広がるパターンが多く、はてブとは違った広がりを見せる。 Twitterのほうが、より「口コミ」っぽいと言える。

#### はてブと同じようにTwitterでの反応を知りたい

せっかくこの日記を読みに来てくれる人がいるんだから、その反応をまとめて読みたい。 どうやらWordPressには Twitter での反応を自分のブログ上のコメント欄に表示する[プラグイン](http://www.ttcbn.net/no_second_life/archives/1144)があるみたい。 URL短縮サービスのbit.lyでも、そのページへのTwitterのつぶやきをまとめて見られるようになっている。 例えば、[「Webを支える技術」本の感想への反応](http://bit.ly/info/c04ipV#conversations_data)を見たりとかね。

調べてみたら、 bit.ly も WordPress のプラグインも、 BackType.com というサービスを利用しているみたい。 BackTypeでは個別エントリへの反応を[Webインタフェース](http://www.backtype.com/connect/www.machu.jp%252fdiary%252f20100416.html%23p01)で見ることもできるし、[ブログに貼り付けるウィジェット](http://www.backtype.com/widgets/tweetcount)も用意されている。 [API](http://www.backtype.com/developers)を使って自分で欲しいデータだけを集めることもできる。

さらに調べていたら、似たようなサービスが他にあることを知った。

* [ブログ記事のTwitterでの「つぶやかれ数」を表示するブログパーツ](http://www.heartlogic.jp/archives/2009/11/twitter_count_widget.html)

最終的に、ここで紹介されている Topsy というサービスを利用することにした。 BackTypeとTopsyを比較しての結論。

* API利用制限: BackType は[非商用で1,000リクエスト/日](http://www.backtype.com/developers)だけど、Topsyは10,000リクエスト/時。
* APIキーの存在: BackTypeのAPIを使うにはAPIキーの取得が必要。Topsyは不要（IPアドレスでチェックしているみたい）。
* ブログパーツ: BackTypeはIFremeで描画しているので、読み込み時に待ちが入る。Topsyは直接DOMを書き換えるので固まらない。また、[パラメータでのカスタマイズも豊富](http://labs.topsy.com/button/retweet-button/)。
* セクションアンカー: BackTypeはURLのアンカー（#以降ね）を無視する。これは1ページに複数の記事が入る tDiary では使いにくい。

#### Topsyの使い方

* 検索文字列に[site:machu.jp](http://topsy.com/s?q=site:machu.jp)などと指定すると、そのサイト内の人気記事リストが表示される。（はてなブックマークでの[○○の人気エントリ](http://b.hatena.ne.jp/entrylist?sort=count\&url=http%3A%2F%2Fwww.machu.jp%2F)に相当）
  * 個別記事へ飛ぶことで、Twitterでのコメント（つぶやかれ）一覧を見ることができる。
* [Topsy Retweet Button](http://labs.topsy.com/button/)を使えば、簡単にブログ上にコメント数を表示できる。
* [API](http://code.google.com/p/otterapi/wiki/Resources)を使えば、より細かく情報を取得できる。ブログへの反応なら stats （つぶやかれ数を取得）や trackbacks （つぶやかれの内容を取得）あたりか。

#### Topsyを使ってtDiaryのRetweetプラグインを書いた

という訳で、 [Topsy の Retweet ボタンを呼び出すプラグイン](http://coderepos.org/share/browser/platform/tdiary/plugin/retweet.rb)を書いた。

[![Topsy Retweet Button on tDiary](https://farm5.staticflickr.com/4024/4550277357_8b590de37d.jpg "Topsy Retweet Button on tDiary")](http://www.flickr.com/photos/machu/4550277357/)

このボタンでできること。

* 表示している日記へのつぶやかれ数を表示
* Retweet ボタン（つぶやくボタン）で日記内容を簡単にTwitterへつぶやき

スクリプト内の @topsy\_nick を書き換えて使ってください。
