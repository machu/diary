---
title: machu.jp ドメインを騙った SPAM メール
date: 2007-12-06T00:00:00.000Z
lastmod: 2007-12-06T16:03:43.000Z
draft: false
tags:
  - Security
  - SenderID
---

やられたよ。 今日の12時〜14時くらいに大量のリターンメールが帰ってきた。 リターンメールを装った SPAM かな？と思っていたんだけど、メールの中身を見るとどうも違うっぽい。

* メールの送信先が XXXXX at machu.jp (XXXXXはメールごとに違う単語)
* 本文に送信に失敗した元メールの内容が書かれている
* 元メールの From も XXXXX at machu.jp になってる

これは…SPAM業者が詐称する From に machu.jp を使ったってことだなぁ。 んで、届かないアドレスがいくつかあるものだから、エラーメールが全部返ってきたと。

これ以上 SPAM をばら撒かれて machu.jp ドメイン全体が SPAM 扱いされると困るので、送信者認証のための SenderID を設定することにした。 本当はこのドメインを取得したときにやっておくべきことだったんだろうなぁ…。 痛い思いをしないと学ばないという。

ドメインは VALUE DOMAIN で管理しているので、 DNS レコードの設定に以下の記述を追加した。

```
txt @ v=spf1 mx include:gmail.com -all
```

SenderID はメールの送信元を限定するための方法。 ここに書いてある送信元以外から送られたメールは偽者ってこと。

* txt @ … machu.jp. に対する TXT レコードを設定 (たぶん VALUE DOMAIN 専用の書き方)
* v=spf1 … SenderID であることを示す文字列 (SPF Ver.1)
* mx … MX レコードに設定したドメインからのメール送信を許可
* include:gmail.com … gmail.com ドメインが許可する送信元からのメール送信を許可

正しく設定されたかどうかを確認する。ついでに Yahoo! Japan の設定と比べてみる。

```
$ dig txt machu.jp
machu.jp.               120     IN      TXT     "v=spf1 mx include:gmail.com -all"

$ dig txt yahoo.co.jp
yahoo.co.jp.            350     IN      TXT     "v=spf1 include:spf01.yahoo.co.jp include:spf02.yahoo.co.jp ~all"
```

ちなみに、 SenderID は SPAM 対策というよりは、なりすまし防止に近いかな。 他人のドメインを騙ったメールを送れなくするためという意味で。 まぁ、 SenderID を設定したとしても、受信側がこの内容をチェックしてくれないと意味がないんだよね。

#### 参考にしたページ

* [My DomainでGoogle Apps: SenderIDの書き方](http://googleapps.hakaede.com/2007/05/senderid_24.html)
* [Sender ID：送信者側の設定作業 − ＠IT](http://www.atmarkit.co.jp/fsecurity/special/82senderid/sender101.html)
* [ドメイン作業メモ - 黒いほう](http://d.hatena.ne.jp/yaske/20070105#p2)
* [Sender IDはスパム対策の切り札となるか!?](http://www.atmarkit.co.jp/fsecurity/rensai/trend01/trend01.html)
* [風見鶏の目: 所有ドメインの偽装メールを防ぐ〜SPFレコードの設定](http://kazamidori.net/kaoru/2006/11/spf.html)
