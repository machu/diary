---
title: 一ヶ月以上前の日記にツッコミできないようにした
date: 2007-12-30T00:00:00.000Z
lastmod: 2007-12-30T12:46:29.000Z
draft: false
tags:
  - tDiary
---

[503 エラーとツッコミ SPAM](/posts/20071212/p01)の続き。 表には出てこないけど、一日に 5000 件ほどのツッコミ SPAM が来ていて負荷の原因になっている。 なので、一ヶ月以上前の日記には、ツッコミできないようにした。 うーん。これって半分負けだよなぁ。

やったこと。

- SPAM フィルタで31日以上前のツッコミを SPAM 判定するように設定
- [コメントフォーム非表示プラグイン](http://www.smallstyle.com/20060713.html#p01)を導入

さて、これでどうなるかな。

#### 追記

やっぱり1ヶ月は短いと思ったので、半年 (130日) にした。

#### 追記 (2)

ここ1ヶ月でやってきた SPAM を、ツッコミ先の日にちごとに集計してみた。 やっぱり半年を過ぎたあたりから SPAM が増加している。

![spam to my diary](@/assets/flickr/2147719126.jpg "spam to my diary")

AntiRefSpamFilter/spamcomments に蓄積されている SPAM を、スクリプトを使って日にちごとに集計。 できたファイルを Excel でグラフにした。

```
$ grep '^To: ' spamcomments | spamcount.rb > count.txt
```

スクリプトはこんな感じ。

```
require 'date'

dates = Hash.new(0)
ARGF.each do |line|
  dates[Date.parse(line)] += 1
end
dates.sort.each do |date, count|
  puts "#{date.year}/#{date.mon}/#{date.day} #{count}"
end
```
