---
title: PukiWiki の SPAM 対策 (Akismet 導入)
date: 2007-05-31T00:00:00.000Z
lastmod: 2014-11-05T20:08:36.000Z
draft: false
tags:
  - wiki
---

Wiki への SPAM や荒らしが増えてきている。 その手法も色々。

* コメント欄に書き込む
* ページ全体を書き換える
* ページの末尾に追記する
* 既存のリンク先を書き換える

特に既存のリンク先を書き換える手法は驚いた。 既存ページからURLをパターンマッチングして、置換しているのかな。

対策として [Akismet](http://akismet.com/) を導入した。 Akismet は、サービス型の SPAM 判定ツール。 コメントの内容を Akismet に送ると、 SPAM かどうかを判定してくれる。

導入までの手順を簡単にメモ。

* [WordPress のページ](http://wordpress.com/api-keys/)でユーザ登録
* APIキーはどこで入手できるんだ？とWordPressのページをさまよう
* 結局、ユーザ登録で送られてきたメールにAPIキーが書いてあった
* [PukiWiki/Akismetによるspam(スパム)防止機能 - ARK-Web SandBox Wiki](http://www.ark-web.jp/sandbox/wiki/190.html)をPukiWikiのプラグインに追加。APIキーの部分だけを書き換える。
* 上記のPluginバージョンよりも、[Akismetによるspam(スパム)防止機能 - PukiWiki-dev](http://pukiwiki.sourceforge.jp/dev/?PukiWiki%2F1.4%2F%A4%C1%A4%E7%A4%C3%A4%C8%CA%D8%CD%F8%A4%CB%2FAkismet%A4%CB%A4%E8%A4%EBspam%28%A5%B9%A5%D1%A5%E0%29%CB%C9%BB%DF%B5%A1%C7%BD)で書かれているpukiwiki.phpを修正する方がよさそう（Plugin版はPOSTデータを丸ごと送るのでゴミが入る）なので、ファイルを入れ替え。
* スパムと判定された場合にログを残すように、 lib/func.php の die\_message 関数を修正した。

一晩動かしてみたら、241件の書き込みが SPAM と判定されていた。 雑多な Wiki への修正も SPAM 判定しているので、誤判定も高くなっていそうだけど、以下の書き込みは SPAM っぽくみえる。

```
2007/05/31 08:11:36     85.255.113.77   投稿はスパムと判断されました.
2007/05/31 08:11:37     85.255.113.77   投稿はスパムと判断されました.k3108に何か一言。
2007/05/31 08:11:39     85.255.113.74   投稿はスパムと判断されました.
2007/05/31 08:11:40     85.255.113.74   投稿はスパムと判断されました.
2007/05/31 08:11:40     85.255.113.76   投稿はスパムと判断されました.
2007/05/31 08:11:41     85.255.113.74   投稿はスパムと判断されました.
2007/05/31 08:11:43     85.255.113.78   投稿はスパムと判断されました.
2007/05/31 08:11:46     85.255.113.76   投稿はスパムと判断されました.
2007/05/31 08:11:47     85.255.113.78   投稿はスパムと判断されました.
2007/05/31 08:11:47     85.255.113.77   投稿はスパムと判断されました.
2007/05/31 08:11:48     85.255.113.74   投稿はスパムと判断されました.
2007/05/31 08:11:49     85.255.113.77   投稿はスパムと判断されました.
2007/05/31 08:11:51     85.255.113.74   投稿はスパムと判断されました.tuyet_com
2007/05/31 08:11:53     85.255.113.74   投稿はスパムと判断されました.
2007/05/31 08:11:56     85.255.113.74   投稿はスパムと判断されました.
2007/05/31 08:11:58     85.255.113.77   投稿はスパムと判断されました.
2007/05/31 08:11:58     85.255.113.77   投稿はスパムと判断されました.
2007/05/31 08:11:59     85.255.113.77   投稿はスパムと判断されました.
```

* 20件/分の書き込みペース（実際にはこのあと２〜３分に渡って続いている）
* 書き込み元の IP アドレスが微妙に変わっている

効果ありそうだから、これでしばらく様子を見てみよう。
