---
title: tDiary  プラグインの更新チェッカー
date: 2012-08-18T00:00:00.000Z
lastmod: 2012-08-18T18:17:58.000Z
draft: false
tags:
  - tDiary
  - heroku
---

Twitterのタイムラインで「プラグインの更新を見落とさない仕組みが欲しいよね」という話が出ていたので作った。

* [plugin\_checker.rb](https://github.com/tdiary/tdiary-contrib/blob/master/plugin/plugin_checker.rb)
* [plugin\_checker.js](https://github.com/tdiary/tdiary-contrib/blob/master/js/plugin_checker.js)

GitHubの [tdiary-contrib](https://github.com/tdiary/tdiary-contrib) リポジトリで更新を見つけると、日記の編集画面でお知らせしてくれる。

![tDiary Plugin Checker](@/assets/flickr/7809454062.jpg "tDiary Plugin Checker")

今のバージョンでは、とりあえず過去7日間の更新をすべて表示するようにしている。いずれは使っているプラグインのみのお知らせを表示したり、何度も同じお知らせが表示されないようにしたい。

更新情報の取得にクロスドメイン通信を使っている。 JSONP ではなく XHR2 (Cross-Origin Resource Sharing) を使っているので、ブラウザが IE では動かないかも。

XHR2 については、この辺のページを参照。JSONPを使っていた頃に比べて、楽になったねぇ。

* [HTTP access control | Mozilla Developer Network](https://developer.mozilla.org/ja/docs/HTTP_access_control)
* [Cross-Origin Resource Sharing](http://www.w3.org/TR/cors/)
* [404 Blog Not Found:Ajax - Goodbye, JSONP. Hello, Access-Control-Allow-Origin](http://blog.livedoor.jp/dankogai/archives/51502865.html)

#### 仕組み

Webブラウザから直接 GitHub API を呼び出すのは大変そうだったので、更新情報を取得するWebサービスを先に作った。Rails3で作成し Heroku 上で動かしている。

* [TDiary Plugin Checker](http://tdiary-plugin-checker.herokuapp.com/)
* [ソースコード (GitHub)](https://github.com/machu/tdiary-plugin-checker)

plugin\_checker.js はGitHub APIを呼び出す代わりに、このサイトから更新情報をJSON形式で取得している。
