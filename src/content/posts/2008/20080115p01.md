---
title: tDiary の contrib パッケージ用の Rakefile 書いた
date: 2008-01-15T00:00:00.000Z
lastmod: 2008-01-15T15:52:51.000Z
draft: false
tags:
  - Ruby
  - tDiary
---

[tDiary-contrib を CoreRepos に移管中の hsbt さん](http://www.hsbt.org/diary/20080115.html#p01)が [Twitterでつぶやいてた](http://twitter.com/hsbt/statuses/601352722)ので、 Rakefile を使ってスクリプトを書いた。 やってることはシンプルで、 CodeRepos のリポジトリから最新版を取得して、 tar.gz でアーカイブするだけ。 シェルでも2行で書けるだろうけど、 Rakefile を使う利点もある。

* contrib が更新されたときだけ、パッケージ (tdiary-contrib.tar.gz) を再生成する

…あれ？これだけ？？ う、うーん。

* Rakefile の使い方をちょっと覚えた
* 将来的にタスクを増やしたいときに管理が楽

Rakefile の中身はこうなってる。

```
package_name = 'tdiary-contrib.tar.gz'
excludes = [".svn", "Rakefile", package_name]

desc 'Update files from Subversion Repository'
task :update do |t|
  sh "svn update"
end

desc 'Packaged tDiary-contrib files'
file package_name => FileList["./**/*"] do |t|
  sh "tar zcf #{package_name} . " + excludes.map{|f| "--exclude #{f}"}.join(' ')
end
```

以下、備忘録を兼ねてポイントだけ。

* tar の --exclude オプションを使って、 .svn ディレクトリと Rakefile と自分自身 (tdiary-contrib.tar.gz) をアーカイブ対象から除外している
* FileList を使えばワイルドカードを使って依存関係のファイルを指定できる
* FileList で \*\* と書くと、ディレクトリを再帰的にたどってくれる (Makefile にも同じ機能あるのかな？)
* FileList で \*\*/\* と書くとタスクが無限ループになってエラーになるので、 ./\*\*/\* と書いている

#### 参考にしたサイト

* [忘れたときに備えた記録 - ほのぼのrake , rakeの名前空間 , EmacsでRakefileの編集 , includeした後のモジュールの改変 , Rakeでtest/unitを実行](http://www.hinet.mydns.jp/tdiary/?date=20070629)
* [RakeByExample - Rake の実例](http://www.kyobashi.org/hf/RakeByExample/?AboutRakeByExample)
