---
title: image.rb から flickr.rb へのマイグレーションツール（続き）
date: 2008-10-21T00:00:00.000Z
lastmod: 2008-10-21T17:07:21.000Z
draft: false
tags:
  - tDiary
---

[昨日の日記](/posts/20081020/p01)の続き。 Flickr への写真のアップは目処がついたので、 tDiary の日記を書き換える方法を調査した。 今のところ、[tdiary grep](http://www.rubyist.net/~matz/20040103.html#p03)の手法が使えるんじゃないかと思ってる。 特に、以下の部分の処理が参考になった。 gets に引数として区切り文字が渡せるんだね。

```
def foreach_diary(path)
  table = {}
  File.open(path) {|f|
    f.each('') do |headers|
      date = headers.slice(/^Date:\s*(\d{4}\d{2}\d{2})/, 1) or
          raise "unexpected tdiary format: Date=nil:\n#{headers.strip}"
      format = headers.slice(/^Format:\s*(\S+)/, 1) or
          raise "unexpected tdiary format: Format=nil:\n#{headers.strip}"
      diary = f.gets("\n.\n").chomp(".\n")
```
