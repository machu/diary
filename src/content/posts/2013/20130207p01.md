---
title: 日記の Unicorn プロセスを定期的に再起動
date: 2013-02-07T00:00:00.000Z
lastmod: 2013-02-11T00:42:32.000Z
draft: false
tags:
  - ruby
  - tDiary
  - unicorn
---

この日記 (tDiary) は [Unicorn](/posts/20120503/p01) で動かしている。しばらく動かしていると使用メモリが増えていき、 monit さんがアラートメールを送ってくる。手動で再起動するのも大変なので、定期的に再起動することにした。

```
 $ cat /etc/cron.hourly/unicorn-restart.sh
 # !/bin/bash

 kill -USR2 `cat /home/machu/var/tdiary/tdiary-core/unicorn.pid`
```

これはひどい。

本当はちゃんと unicorn の起動シェルを作って、 monit 経由で再起動したほうがよい。でも、 rbenv 環境でお手軽にやる方法が分からなかったので、これでお茶を濁そう。
