---
title: Twitter 認証が使えなくなっていたので OmniAuth をバージョンアップ
date: 2013-07-04T00:00:00.000Z
lastmod: 2013-07-05T14:21:05.000Z
draft: false
tags:
  - ruby
  - sinatra
  - OAuth
  - twitter
---

[Amazon API認証リバースプロキシ](/posts/20110925/p01)では、ログインに Twitter のアカウントを使う。 Twitter 側の認証の仕組みが変わって、ログインできなくなっていたので、認証ライブラリ (OmniAuth) をバージョンアップさせて対応した。

OmniAuth はこれまで使っていたバージョン 0.3 と最新の 1.1.4 では、仕様が異なる。[Upgrading to 1.0 · intridea/omniauth Wiki](https://github.com/intridea/omniauth/wiki/Upgrading-to-1.0) を読んで、最新バージョンに更新した。と言っても、変えたのはわずか2箇所。

1. Twitter認証用の Strategy が外部 gem 化 （omniauth-twitter）されたので、読み込み
2. 認証結果からユーザ情報を取り出すときのハッシュキーが、 `user_info` から`info` に変わった

ソースの差分は↓↓↓。

- [update omniauth · ebc9c69 · machu/rpaproxy-sinatra](https://github.com/machu/rpaproxy-sinatra/commit/ebc9c69b30d61556b0a753bcb783d35b8c74760f)

ともあれ、これで Twitter 認証が復活。
