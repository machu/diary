---
title: new relicとmackerel.ioでサーバを監視するようにした
date: 2015-11-15T00:00:00.000Z
lastmod: 2015-11-15T12:40:07.000Z
draft: false
tags:
  - server
---

この日記はさくらのVPS上にCoreOS＋docker環境で動かしている。同じホスト上で動かしている[Product Advertising API用リバースプロキシ](http://rpaproxy.tdiary.org)がたまに落ちることがある。いつもはdocker側で再起動するように設定しているけど、こないだは再起動せずにサービスが止まったままになっていた。

そのせいで、[ただのにっきを落としてしまっていた](http://sho.tdiary.net/20151109.html#p01)ので、これはまずいとサーバを監視するようにした（本当は落ちないように原因を調べないと…）。

new relicは導入済みだったので、URL to monitorを設定して繋がらないときはアラートメールを送るようにした。試しにrpaproxyのdockerコンテナを停止してみて、ちゃんとアラートが上がることを確認した。

合わせて、 @[tdtds](https://twitter.com/tdtds) から勧められた <https://mackerel.io/> も導入した。docker環境なので、 mackerel のエージェントもdockerコンテナとしてインストールしている。手順は[公式サイト](http://help-ja.mackerel.io/entry/advanced/docker)を参照。何も設定していなくても、ちゃんとdockerコンテナごとのCPUとメモリ使用量をカウントしてくれるのはとても便利。コンテナが落ちたときにアラートを上げられるといいのだけど、それはのちのちに。
