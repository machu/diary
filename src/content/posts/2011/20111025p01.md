---
title: Apacheモジュール版認証プロキシをAmazon APIの仕様変更に追従
date: 2011-10-25T00:00:00.000Z
lastmod: 2011-10-26T13:07:19.000Z
draft: false
tags:
  - memo
  - amazon
---

[Sinatra版Amazon-Auth-Proxyの運用を始めた - ただのにっき(2011-10-23)](http://sho.tdiary.net/20111023.html#p01)より。

> ちなみに今回のAmazonのAPI変更は、正式なAssociateTagが含まれていないクエリは受け付けなくなるというものなので、今まで日本のAmazon用AssociateTagを使い回して各国向けのクエリを処理していたプロキシは、軒並みダメになる。ちゃんとそれぞれの国向けのAmazonで専用のAssociateTagを発行してもらわなくてはいけないのだ。現在プロキシを運用している人は、今月末までに自分の環境を見なおしましょう。

という訳で、machu.jpドメイン（さくらのVPSサーバ）で動かしていた[Apacheモジュール版の認証プロキシ](https://github.com/machu/mod_amazon_proxy)も日本向けロケールのみに変更した。 具体的には[httpd-amazon-proxy.conf](https://github.com/machu/mod_amazon_proxy/blob/master/httpd-amazon-proxy.conf.sample)の設定から /amazon\_proxy/jp だけを残して他の設定を削除した。

```
<Location /amazon_proxy/jp>
	AmazonAccessKey your_access_key
	AmazonSecretKey your_secret_key
	# AmazonDefaultAid your_aid_if_you_want  # optional
	AmazonEndPoint ecs.amazonaws.jp
	AmazonXsltEndPoint xml-jp.amznxslt.com
	SetHandler amazon_proxy
</Location>
```

あとは[Product Advertising API用リバースプロキシ](http://rpaproxy.tdiary.org/)の設定を更新しておしまい。
