---
title: XREAへの設置
date: 2003-12-25T00:00:00.000Z
lastmod: 2004-08-23T15:23:29.000Z
draft: false
tags:
  - tDiary
---

* CGIのパスを変更 (index.rb, update.rb)

```
/usr/bin/env ruby
```

```
/usr/local/bin/ruby
```

* ファイル名を変更

xreaでは拡張子は.cgiでないと、CGIとして動作しない。

```
index.rb -> nph-index.cgi
update.rb -> update.cgi
```

* nph-index.cgiのnph対応 (参考: [xrea で tdiary を正常に動かす方法](http://tmaeda.s45.xrea.com/td/20031221.html#p01))

```
head = {
  'nph' => true,
  'type' => 'text/html',
  'Vary' => 'User-Agent'
}
```

```
rescue TDiary::ForceRedirect
  head = {
    #'Location' => $!.path
    'nph' => true,
    'type' => 'text/html',
  }
```

* tdiary.confの編集

```
@data_path = '/virtual/machu/data/tdiary'
@style = 'Wiki'
@update = 'update.cgi'
```

* .htaccessの編集

```
Options +ExecCGI

#AddHandler cgi-script-debug .cgi
DirectoryIndex nph-index.cgi

RewriteEngine on
RewriteBase /diary
RewriteRule ^([0-9]+)\.html$ nph-index.cgi?date=$1

<Files "*.rhtml*">
	deny from all
</Files>

<Files "tdiary.*">
	deny from all
</Files>

<Files update.cgi>
	AuthName      tDiary
	AuthType      Basic
	AuthUserFile  /virtual/machu/.htpasswd
	Require user  machu
</Files>
```

* データディレクトリの作成

```
$ mkdir /virtual/machu/data/tdiary
$ chmod 700 /virtual/machu/data/tdiary
```

XREAはCGIにSIDがセットされユーザ権限で動作するため、700でOk。

* .htpasswdの作成
