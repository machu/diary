---
title: 人気の日記プラグイン (はてなブックマーク)
date: 2005-12-27T00:00:00.000Z
lastmod: 2005-12-28T03:21:54.000Z
draft: false
tags:
  - tDiary
  - plugin
  - hatena
---

[はてなブックマーク件数取得API](http://d.hatena.ne.jp/keyword/%a4%cf%a4%c6%a4%ca%a5%d6%a5%c3%a5%af%a5%de%a1%bc%a5%af%b7%ef%bf%f4%bc%e8%c6%c0API)を使った[人気の日記プラグイン](/posts/20051212/p01)を修正した。 本当は[Xmasイヴハック](http://blog.kan.vc/1135346090.html)に対抗していたんだけど、間に合わずに2日遅れになってしまった。

今回の最大の変更点は、各セクションのフッタにブックマーク数を表示できるようにしたこと ([section_footer.rb](http://www.hsbt.org/hiki/hiki.cgi?section_footer.rb) の改造要) 。 取得したブックマーク数はキャッシュするようにしているので、それほど負荷にはならない…はず。 その他の修正点は以下のとおり。

- hsbtさんの[REXMLとUconvを使う版](http://hsbt.que.ne.jp/diary/20051215.html#p01)と[見た目の改良](http://www.hsbt.org/diary/20051213.html#p01)を取り込み (ありがとうございます) 。
- キャッシュファイルを2つから1つに減らした。

#### ダウンロード

- [人気の日記プラグイン](http://dev.machu.jp:8080/sbs_plugin/trac.cgi/file/trunk/hatena_bookmark.rb) ([ダウンロード用](http://dev.machu.jp:8080/sbs_plugin/trac.cgi/file/trunk/hatena_bookmark.rb?rev=3&format=raw))

#### セクションのフッタにブックマーク件数を表示する

[section_footer.rb](http://www.hsbt.org/hiki/hiki.cgi?section_footer.rb) の『「このエントリを含むはてなブックマーク」へのリンクの追加』あたりを適当に修正する。

```
if @hatena_bookmark && @hatena_bookmark[:counts]
  users = @hatena_bookmark[:counts][permalink(date, index, false)]
  # if users && users > 0 でも可。お好みで。
  if users
    r << %Q|<a href="http://b.hatena.ne.jp/entry/#{permalink(date, index)}" title="このエントリを含むはてなブックマーク">#{users} Users</a>|
  end
else
  r << %Q|<a href="http://b.hatena.ne.jp/entry/#{permalink(date, index)}"><img src="./images/b_entry_de.gif" border="0" title="このエントリを含むはてなブックマーク" alt="このエントリを含むはてなブックマーク" width="16" height="12" class="icon"></a>|
end
```

#### 参考

[Ajaxなtooltipを使った実装](http://amrita.s14.xrea.com/d/?date=20051225#p01)なんてのもある。 はてなブックマークだけじゃなくて、 mm/memo の件数も分かるといいよなあぁ。
