---
title: Googleフォトの写真を日記に載せるためのtDiaryプラグインを書いた
date: 2017-06-10T00:00:00.000Z
lastmod: 2017-06-11T02:03:14.000Z
draft: false
tags:
  - tDiary
---

[Picasaがサービス終了](https://support.google.com/picasa/answer/6383491?hl=ja)し、[Flickrの先行きも不透明](http://jp.techcrunch.com/2016/07/26/20160725verizon-buys-yahoo-for-4-83-billion/)になっている。そこで、Googleフォトの写真を日記に載せられるようにプラグインを作った。

- [Googleフォトプラグイン](http://docs.tdiary.org/ja/?google_photos.rb)

こんな風に、Googleフォトにアップした写真を選択して、日記に貼り付けることができる。PC上の写真をGoogleフォトにアップロードすることもできる。

![photo](https://lh3.googleusercontent.com/-5BhXRXfdK4g/WTyakHq3rTI/AAAAAAAETjQ/XnPmo31Gy2MfGIpqFHhMXBXwQc2gfD4pwCE0/4b889084-405c-11e7-8a71-6aae838cd828.png "photo")

プラグインは[contribパッケージに取り込まれた](https://github.com/tdiary/tdiary-contrib/pull/180)ので、最新版を取得すれば利用可能。制約事項は、写真の最大サイズが512ピクセルまでということと、プラグインを使うためにGoogleのAPIキーを取得する必要があること。少しでも負担を減らそうと、[APIキーの取得手順](https://www.evernote.com/shard/s18/sh/7211b9c3-fb75-4af8-aa55-718ff6c81aac/77c3a51871f0f245)をスクリーンショット付きで書いてみた。

#### 技術的な話

[Picasa Webが突然止まったのでFlickrへ乗り換え中](http://sho.tdiary.net/20160809.html#p01)より引用。

> 困るのはアルバムを「公開」にしてAPIから取得する手段がなくなったことだ。Google Photosにはそういう機能ないからな。これがないと、日記に写真を貼ることができないのだ。

FlickrやPicasaは写真やアルバムの公開機能があったので、API経由で写真へのリンクを取得することができた。一方、GoogleフォトはAPIがなく、[公式サイトでも宣言](https://support.google.com/picasa/answer/6383491)しているとおり、外部サイトへ写真を貼り付けることができない。

> Google フォトではご利用いただけない Picasa ウェブ アルバムの機能
>
> - ウェブサイトへの写真やアルバムの埋め込み。

代わりに[Google Picker API](https://developers.google.com/picker/)を使って、Googleフォトの写真を取得している。このAPIは、Googleに保存している情報をダイアログのように選択するライブラリで、JavaScriptで呼び出す仕組みになっている。プログラム的にはファイルダイアログを操作するようなコードを書くだけで良い。

これでFlickrのように写真のURLとリンクが取得できれば良いのだけれど、残念ながらGoogle Picker APIで取得できるリンク先が `picasaweb.google.com` になっている。これだと、リンク先に飛んでも本人しか写真を見ることができない。代わりに、サムネイル用のURLが取得できるので、Googleフォトプラグインではサムネイル用の写真を直リンク的に日記へ埋め込む仕様としている。

最近のAPIらしく、Google Picker APIを利用するためには事前にAPIキーの取得が必要。日記の設置者がそれぞれキーを取得しなくちゃいけないのはなんだかなーという感じ。

#### 参考にしたサイト

- [Google Pickerを使ってWebサイトのUXを向上させよう](http://qiita.com/howdy39/items/a7de282e6dd5350f7a7c)
- [Googleフォト埋め込みタグジェネレーター](http://hr-sano.net/google-photos-embed-code-generator/)
- [Picker API Developer's Guide](https://developers.google.com/picker/docs/)
- [Google各サービスの写真や動画などが簡単に紹介できる機能を追加しました - はてなブログ開発ブログ](http://staff.hatenablog.com/entry/2012/02/23/155059)
