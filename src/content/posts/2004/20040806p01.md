---
title: さくらインターネット その７ - RUBYLIB
date: 2004-08-06T00:00:00.000Z
lastmod: 2004-08-06T05:27:13.000Z
draft: false
tags:
  - memo
---

Webに設置予定の tDiary や BitChannel では、 uconv などのライブラリを使用する。 それぞれのプログラムごとにライブラリを置くのも管理が大変なので、共通のディレクトリにライブラリを置けないか試してみた。

Rubyでは、ライブラリの読み込み場所を[いくつかの方法](http://www.ruby-lang.org/ja/man/index.cgi?cmd=view;name=%C1%C8%A4%DF%B9%FE%A4%DF%CA%D1%BF%F4#a.24.3a)で指定できる。 ここでは、各プログラムに変更を加えなくてすむように、[RUBYLIB環境変数](http://www.ruby-lang.org/ja/man/index.cgi?cmd=view;name=%B4%C4%B6%AD%CA%D1%BF%F4#RUBYLIB)を使うことにする。

CGI経由で起動されるプログラムへ環境変数を伝えるためには、 .htaccess の [SetEnv ディレクティブ](http://www.ems-i.net/manual/mod/mod_env.html.ja.jis#setenv)を使う。 /home/machu/lib/ruby に拡張モジュールを置いているとすると、 .htaccess には以下のように指定する。

```
SetEnv RUBYLIB /home/machu/lib/ruby
```

ところが、これで試してみてもうまくいかない。 どうやらプログラムに RUBYLIB 環境変数が渡されていない模様。 あれこれ調べていると、Apacheの[ドキュメント](http://httpd.apache.org/docs/env.html#setting)に以下のように書かれていた。

> CGI スクリプトを起動するために suexec が使用されている場合、CGI スクリプトが起動するために、環境変数は安全な環境変数の組に整理されます。 この安全な環境変数の集合は、コンパイル時に suexec.c で定義されます。

う〜ん。SetEnv で伝えられる環境変数には制限があるってことね。 XREA だと RUBYLIB は通ったのになぁ。 面倒でも、各スクリプトの先頭に

```
#!/usr/bin/env ruby -I /home/machu/lib/ruby
```

と書くしかないのか…。
