---
title: アクセスログ
date: 2004-08-20T00:00:00.000Z
lastmod: 2007-09-01T18:10:12.000Z
draft: false
tags:
  - memo
---

さくらのレンタルサーバには、標準でアクセスログ解析ツールがついてきているけど、試しに AWStats という解析ツールを入れてみた。 インストールには[CYBERAM Documents](http://cyberam.dip.jp/linux_server/log/awstats60_main.html)のコンテンツが参考になった。

さくらのログは、最新の一日分のログが $HOME/log/access\_log\_YYYYMMDD というファイル名で残るようになっている。 一日経つと、 access\_log\_YYYYMMDD.gz というファイル名で圧縮されるようになるけど、圧縮される前にログ解析すれば問題なし。

また、検索語の日本語を表示させるために、 ログに解析前に[conv\_weblog\_to\_utf8.pl](http://www.ganaware.jp/viewcvs.cgi/conv_weblog_to_utf8/conv_weblog_to_utf8.pl)というフィルタを通すようにしている。 設定ファイルの変更点は以下のとおり。

```
@@ -48,7 +48,7 @@
 # If there is several log files from load balancing servers :
 # Example: "/pathtotools/logresolvemerge.pl *.log |"
 #
-LogFile="/var/log/httpd/mylog.log"
+LogFile="conv_weblog_to_utf8.pl /home/machu/log/access_log_%YYYY-0%MM-0%DD-0 |"


 # Enter the log file type you want to analyze.
@@ -140,7 +140,7 @@
 # Example: "ftp.domain.com"
 # Example: "domain.com"
 #
-SiteDomain=""
+SiteDomain="www.machu.jp"


 # Enter here all other possible domain names, addresses or virtual host
@@ -198,7 +198,7 @@
 # Example: "/awstats"
 # Default: "/cgi-bin"   (means awstats.pl is in "/yourwwwroot/cgi-bin")
 #
-DirCgi="/cgi-bin"
+DirCgi="/admin/awstats"


 # Relative or absolute web URL of your awstats icon directory.
@@ -850,7 +850,7 @@
 #  First available language accepted by browser=auto
 # Default: "auto"
 #
-Lang="auto"
+Lang="jp"


 # Set the location of language files.
```

これで、下記のシェルを毎日実行して、最新のアクセスログを登録するようにしている。

```
#!/bin/sh

PATH=$PATH:$HOME/bin
cd $HOME/www/admin/awstats
./awstats.cgi -config=awstats.conf -update
```

アクセスログは朝の5時前に更新されているようなので、 このシェルも5時ごろに実行するようにしている。
