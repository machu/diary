---
title: tdiary.vim (2)
date: 2004-02-09T00:00:00.000Z
lastmod: 2004-03-16T02:53:40.000Z
draft: false
tags:
  - tDiary
---

[tdiary.vimが文字化けする件](/posts/20040207/p01)について、うえちさんより[コメントを頂いた](http://www.potaway.net/tdiary/20040209.html#p01)。

> iconv で euc-jp に変換後に URLエンコードしてからアップロードしているので大丈夫だと思ったのだが何で化けるのだろうか。

そこで、iconvを使っているところをコメントアウトしてみたところ、なんと文字化けしなくなった。（この日記もtdiary.vimを使っている）

```
function! s:URLencode(str)
-       let r = iconv(a:str, &encoding, 'euc-jp')
+       let r = a:str
        let r = substitute(r, '[^ a-zA-Z0-9_.-]', '\=s:Char2Hex(submatch(0))', 'g')
```

謎は深まるばかり・・・。でも、これで使ってみよう。

tdiary_update_script_nameへの対応、ありがとうございます ＞ うえちさん

#### 補足

```
! [tDiary] あいうえお

This is a test.
```

上のような日記を書いてアップロードすると、こんな風になっていた。

```
$ od -toC -a diary.after
0000000 041 040 133 164 104 151 141 162 171 135 040 276 244 043 242 360
          !  sp   [   t   D   i   a   r   y   ]  sp   >   $   #   "   p
0000020 276 244 242 360 276 244 242 360 241 257 276 244 242 354 012 012
          >   $   "   p   >   $   "   p   !   /   >   $   "   l  nl  nl
0000040 124 150 151 163 040 151 163 040 141 040 164 145 163 164 056 012
          T   h   i   s  sp   i   s  sp   a  sp   t   e   s   t   .  nl
0000060 012
         nl
0000061
```
