---
title: Estraier でサイト内検索
date: 2004-08-20T00:00:00.000Z
lastmod: 2007-09-01T18:10:12.000Z
draft: false
tags:
  - memo
---

[以前](/posts/20040804/p02)からこの日記の検索に Estraier を使っていたけど、 サイト全体（tDiary と BitChannel のコンテンツ）を検索対象にするようにした。

tDiaryのコンテンツは、squeezeプラグインを使って静的な HTML に変換している。 BitChannelのコンテンツは、添付の misc/tohtml.rb を改造して ファイルごとに静的 HTML を出力するようにした。

検索インデックスを生成するために、このようなシェルを毎晩 cron で動かしている。

```
#!/bin/sh

cd $HOME/var/bitchannel/misc
./tohtml2.rb -o $HOME/var/bitchannel/html

cd $HOME/www/search/
estindex register -relax -hsuf '*' index $HOME/var/tdiary/cache/html/
estindex register -relax -hsuf '*' index $HOME/var/bitchannel/html/
estindex relate -relax index
estindex purge -relax index
estindex optimize -relax index
```

今のところ、ちゃんと動いているみたい。
