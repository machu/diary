---
title: 時刻同期 (2)
date: 2004-01-24T00:00:00.000Z
lastmod: 2004-01-31T19:49:22.000Z
draft: false
tags:
  - Gentoo
---

サーバの時刻をインターネット上の時刻サーバと同期させたいと思う。 [前回](/posts/20040112/p04)も挑戦したのだが、rdateではほとんどの時刻サーバから接続を拒否されてしまっていた。

調べてみると、rdateが使うプロトコルは[RFC 868のTime Protocol](http://www.ietf.org/rfc/rfc0868.txt)であり、ほとんどの時刻サーバが利用しているNTPプロトコルを使うためにはntpdateが必要らしい。

Debianだとapt-getでntpdateだけを取ってこれるようだけど、Gentooだとntpdを含めてインストールしなければいけないみたい。

```
$ sudo emerge ntp
```

次に、設定ファイル (/etc/conf.d/ntp-client) に[時刻サーバ](http://plamo.minidns.net/ntpsites.shtml)を追加する。

```
NTPCLIENT_CMD="ntpdate"
NTPCLIENT_OPTS="-b ntp1.jst.mfeed.ad.jp ntp2.jst.mfeed.ad.jp ntp3.jst.mfeed.ad.jp"
```

起動時にntpdateが実行されるように設定する。

```
sudo /sbin/rc-update add ntp-client default
```

このままだと、起動時にしかntpdateが実行されない（気がする）。定期的に時刻を同期するには、cronに設定するかntpdを使わないといけないのかな。とりあえず、 /etc/cron.hourly に ntpdate.cron を作成した。

```
#!/bin/sh

/etc/init.d/ntp-client restart
```
