---
title: ISPのメールサーバをBackup MXに
date: 2004-04-19T00:00:00.000Z
lastmod: 2004-04-20T00:58:49.000Z
draft: false
tags:
  - Gentoo
---

自宅にメールサーバを構築したんだけど、万が一サーバが落ちていたらメールが届かないという心配がある。 そこで、ISPのメールサーバをバックアップ用に使うことを考える。 通常は自宅のメールサーバにメールが届くが、サーバが落ちている場合はISP側にメールを受信しておいてもらうのだ。

まず、DNSのMXレコードを編集し、自宅のサーバを優先度10, ISPのメールサーバを優先度20としておく。 これで、自宅のサーバにメールが届けられない場合は、ISPのメールサーバにメールが届くようになる。

ISP側に届いたメールは、fetchmail を使って定期的にチェック・受信する。 その際、fetchmailrcを以下のように設定することで、ローカルの Postfixへ配送するようになる。

```
poll someone.example.com
  user machu pass dummy is machu here
```

また、.forward に

```
| /usr/local/bin/scmail-deliver
```

と書いておくことで、振り分けプログラムであるscmailを呼び出すこともできる。

単一のユーザの場合はこれでいいんだけど、あとはtmlとの連携を考えないとなぁ。 メールサーバ上のユーザ名とローカルのPostfixに渡すユーザ名を自動的にマッピングできるといいんだけど。
